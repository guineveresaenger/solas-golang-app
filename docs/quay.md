# Overview

Quay is a container and application repository/registry service, used to host
artifacts generated by [GitLab](./gitlab.md). `solas-container` 
[GitHub](./github/.md) repositories generate container artifacts stored in a
[Quay Container Repository](https://quay.io/repository/). `solas-chart`
repositories generate Helm chart artifacts stored in the
[Quay Application Registry](https://quay.io/application/). Hosting these
artifacts in Quay enables easy sharing with others. This guide will show you how
to create repositories and prepare for GitLab to take over.

The following assumes a repository that's been duplicated according to the [README](../README.md) instructions.

## [Create](https://docs.quay.io/guides/create-repo.html) a Repository in Quay


### Naming

Artifacts for the Samsung CNCT organization are stored in the `samsung_cnct`
namespace. By convention, the artifact name is driven by the chart or container name. 
For example, the artifact for the container repository `container-zabra` is named 
`zabra-container`. And for the application repository `chart-zabra`, the
artifact is named simply `zabra`. We've chosen this naming convention because the application, not
the container, is generally the artifact we expect users to interact with.

#### Exception
Because Quay repositories and applications share the same namespace, and because we have some older Quay artifacts, there are some cases in which the plain `zabra` name for a chart is already taken on Quay. In this case, the chart artifact  is called `zabra-chart`.

## Create a repository

To create a repository, log into [quay.io](https://quay.io) and follow the steps shown in the screenshot below, 

<p align="center">
  <img src="https://github.com/NancyHarvey/solas/blob/master/docs/images/quay/Create%20new%20repo.png"; width="800" title="Create a repo">
</p>

After naming your repo, configure the remaining settings:
<p align="center">
  <img src="https://github.com/NancyHarvey/solas/blob/master/docs/images/quay/Create%20new%20repo%20cont.png"; width="700" title="Create a repo">
</p>

## Create a Robot Account

We use robot accounts to authenticate and authorize access to Quay-hosted repositories. 
GitLab needs access to push artifacts to the registry. We use a different robot account for each repository to improve auditing and prevent some mistakes, such as a build job accidently publishing to
the wrong repository.

By convention, robot accounts are named after the artifact they're associated
with and the permissions they grant. Dashes are not allowed in robot names, so
they are replaced by underscores. For example, read/write premissions for
the `zabra-container` artifact are named `zabra_container_rw`. The same
permissions for `zabra` are `zabra_rw`, or in [some cases](#exception) `zabra_chart_rw`.

* Go to your repository's settings
* Under the section ` User and Robot Permissions`
  * Click Create Robot Account from the `Select a team or user` drop-down menu
  * Name your robot according to the convention above
  * Grant the robot `write` access
  * While in settings, click `Owners` from the `Teams` section of the drop-down and grant `admin` privileges

![screenshot](images/quay/zabra-permissions.png)